import json

d = {'name': 'Access - Geographically Improbable Access Detected - Rule : Access - Geographically Improbable Access Detected - Rule', 'rawJSON': '{"_bkt": "notable~1112~66D21DF4-F4FD-4886-A986-82E72ADCBFE9", "_cd": "1112:16439", "_indextime": "1615971928", "_raw": "1615971000, search_name=\\"Access - Geographically Improbable Access Detected - Rule\\", orig_raw=\\"03/17/2021 01:50:00 -0700, search_name=\\\\\\"Access - Geographically Improbable Access - Summary Gen\\\\\\", search_now=1615971000.000, info_min_time=1615905600.000, info_max_time=1615971000.000, info_search_time=1615971016.489, src=\\\\\\"5.11.64.17\\\\\\", dest=\\\\\\"54.69.58.248\\\\\\", user=\\\\\\"rcloward@acmetech.com\\\\\\", speed=\\\\\\"733.026\\\\\\", src_app=\\\\\\"CrowdStrike Authentication\\\\\\", src_lat=\\\\\\"54.70650\\\\\\", dest_app=\\\\\\"CrowdStrike Authentication\\\\\\", dest_lat=\\\\\\"45.86960\\\\\\", distance=\\\\\\"5108.58\\\\\\", src_city=Kaliningrad, src_long=\\\\\\"20.51100\\\\\\", src_time=1615922514, dest_city=Boardman, dest_long=\\\\\\"-119.68800\\\\\\", dest_time=1615947604, src_country=Russia, dest_country=\\\\\\"United States\\\\\\", forceCsvResults=\\\\\\"auto\\\\\\"\\", orig_time=\\"1615971000\\", dest=\\"54.69.58.248\\", dest_app=\\"CrowdStrike Authentication\\", dest_city=\\"Boardman\\", dest_country=\\"United States\\", dest_lat=\\"45.86960\\", dest_long=\\"-119.68800\\", dest_time=\\"1615947604\\", distance=\\"5108.58\\", info_max_time=\\"1615971900.000000000\\", info_min_time=\\"1615968000.000000000\\", info_search_time=\\"1615971915.369910000\\", speed=\\"733.026\\", src=\\"5.11.64.17\\", src_app=\\"CrowdStrike Authentication\\", src_city=\\"Kaliningrad\\", src_country=\\"Russia\\", src_lat=\\"54.70650\\", src_long=\\"20.51100\\", src_time=\\"1615922514\\", user=\\"rcloward@acmetech.com\\"", "_serial": "18", "_si": ["ip-172-31-44-193", "notable"], "_sourcetype": "stash", "_time": "2021-03-17T02:05:28.000-07:00", "dest": "54.69.58.248", "dest_risk_object_type": "system", "dest_risk_score": "400", "host": "ip-172-31-44-193", "host_risk_object_type": "system", "host_risk_score": "0", "index": "notable", "linecount": "1", "priorities": "critical", "priority": "critical", "risk_score": "620", "rule_description": "Access - Geographically Improbable Access Detected - Rule", "rule_name": "Access - Geographically Improbable Access Detected - Rule", "rule_title": "Access - Geographically Improbable Access Detected - Rule", "security_domain": "Access - Geographically Improbable Access Detected - Rule", "severity": "unknown", "source": "Access - Geographically Improbable Access Detected - Rule", "sourcetype": "stash", "splunk_server": "ip-172-31-44-193", "src": "5.11.64.17", "src_risk_object_type": "system", "src_risk_score": "460", "urgency": "medium", "user": "rcloward@acmetech.com", "user_bunit": "americas", "user_category": ["officer", "pip"], "user_email": "rcloward@acmetech.com", "user_first": "Raylene", "user_identity": ["cloward", "rcloward", "rcloward@acmetech.com"], "user_identity_tag": ["officer", "pip", "americas"], "user_last": "Cloward", "user_managedBy": "Elissa Whitmoyer", "user_phone": "+1 (800)555-9908", "user_phone2": "+1 (800)555-5055", "user_prefix": "Ms.", "user_priority": "critical", "user_risk_object_type": "user", "user_risk_score": "620", "user_startDate": "788227800.000000", "user_watchlist": "false", "user_work_city": "San Francisco"}', 'labels': [{'type': 'security_domain', 'value': 'Access - Geographically Improbable Access Detected - Rule'}], 'occurred': '2021-03-17T02:05:28.000-07:00', 'details': 'Access - Geographically Improbable Access Detected - Rule', 'severity': 2}

def is_internal_splunk_field(field_name):
    return field_name.startswith('_')


def clear_internal_fields(incident):
    """Removes all the internal fields from the incident, except for several specific fields.
    The fields we do not remove are helpful in distinguishing between events,
    and help us make sure the hash will be unique even between events that return very little non-internal fields.

    Args:
        incident (dict): An incident parsed from a Splunk event.
    """
    internal_fields_to_delete = []
    needed_internal_fields = ['_bkt', '_cd', '_time', '_indextime', '_raw']
    for field_name, _ in incident.items():
        print(field_name)
        if is_internal_splunk_field(field_name) and field_name not in needed_internal_fields:
            internal_fields_to_delete.append(field_name)

    for internal_field in internal_fields_to_delete:
        del incident[internal_field]


d2 = {'name': 'Access - Geographically Improbable Access Detected - Rule : Access - Geographically Improbable Access Detected - Rule', 'rawJSON': '{"_bkt": "notable~1112~66D21DF4-F4FD-4886-A986-82E72ADCBFE9", "_cd": "1112:16439", "_indextime": "1615971928", "_raw": "1615971000, search_name=\\"Access - Geographically Improbable Access Detected - Rule\\", orig_raw=\\"03/17/2021 01:50:00 -0700, search_name=\\\\\\"Access - Geographically Improbable Access - Summary Gen\\\\\\", search_now=1615971000.000, info_min_time=1615905600.000, info_max_time=1615971000.000, info_search_time=1615971016.489, src=\\\\\\"5.11.64.17\\\\\\", dest=\\\\\\"54.69.58.248\\\\\\", user=\\\\\\"rcloward@acmetech.com\\\\\\", speed=\\\\\\"733.026\\\\\\", src_app=\\\\\\"CrowdStrike Authentication\\\\\\", src_lat=\\\\\\"54.70650\\\\\\", dest_app=\\\\\\"CrowdStrike Authentication\\\\\\", dest_lat=\\\\\\"45.86960\\\\\\", distance=\\\\\\"5108.58\\\\\\", src_city=Kaliningrad, src_long=\\\\\\"20.51100\\\\\\", src_time=1615922514, dest_city=Boardman, dest_long=\\\\\\"-119.68800\\\\\\", dest_time=1615947604, src_country=Russia, dest_country=\\\\\\"United States\\\\\\", forceCsvResults=\\\\\\"auto\\\\\\"\\", orig_time=\\"1615971000\\", dest=\\"54.69.58.248\\", dest_app=\\"CrowdStrike Authentication\\", dest_city=\\"Boardman\\", dest_country=\\"United States\\", dest_lat=\\"45.86960\\", dest_long=\\"-119.68800\\", dest_time=\\"1615947604\\", distance=\\"5108.58\\", info_max_time=\\"1615971900.000000000\\", info_min_time=\\"1615968000.000000000\\", info_search_time=\\"1615971915.369910000\\", speed=\\"733.026\\", src=\\"5.11.64.17\\", src_app=\\"CrowdStrike Authentication\\", src_city=\\"Kaliningrad\\", src_country=\\"Russia\\", src_lat=\\"54.70650\\", src_long=\\"20.51100\\", src_time=\\"1615922514\\", user=\\"rcloward@acmetech.com\\"", "_serial": "18", "_si": ["ip-172-31-44-193", "notable"], "_sourcetype": "stash", "_time": "2021-03-17T02:05:28.000-07:00", "dest": "54.69.58.248", "dest_risk_object_type": "system", "dest_risk_score": "400", "host": "ip-172-31-44-193", "host_risk_object_type": "system", "host_risk_score": "0", "index": "notable", "linecount": "1", "priorities": "critical", "priority": "critical", "risk_score": "620", "rule_description": "Access - Geographically Improbable Access Detected - Rule", "rule_name": "Access - Geographically Improbable Access Detected - Rule", "rule_title": "Access - Geographically Improbable Access Detected - Rule", "security_domain": "Access - Geographically Improbable Access Detected - Rule", "severity": "unknown", "source": "Access - Geographically Improbable Access Detected - Rule", "sourcetype": "stash", "splunk_server": "ip-172-31-44-193", "src": "5.11.64.17", "src_risk_object_type": "system", "src_risk_score": "460", "urgency": "medium", "user": "rcloward@acmetech.com", "user_bunit": "americas", "user_category": ["officer", "pip"], "user_email": "rcloward@acmetech.com", "user_first": "Raylene", "user_identity": ["cloward", "rcloward", "rcloward@acmetech.com"], "user_identity_tag": ["officer", "pip", "americas"], "user_last": "Cloward", "user_managedBy": "Elissa Whitmoyer", "user_phone": "+1 (800)555-9908", "user_phone2": "+1 (800)555-5055", "user_prefix": "Ms.", "user_priority": "critical", "user_risk_object_type": "user", "user_risk_score": "620", "user_startDate": "788227800.000000", "user_watchlist": "false", "user_work_city": "San Francisco"}', 'labels': [{'type': 'security_domain', 'value': 'Access - Geographically Improbable Access Detected - Rule'}], 'occurred': '2021-03-17T02:05:28.000-07:00', 'details': 'Access - Geographically Improbable Access Detected - Rule', 'severity': 2}
clear_internal_fields(json.loads(d2['rawJSON']))